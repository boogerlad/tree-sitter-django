==================
for empty verbatim
==================

{% for x in items %}
  {{ x }}
{% empty %}
  {% verbatim %}{{ x }}{% endverbatim %}
{% endfor %}

---

(template
  (content)
  (block
    (for_block
      (loop_targets
        (loop_target))
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (content)
      (interpolation
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))
      (content)
      (content)
      (block
        (verbatim_block))
      (content)))
  (content))

==================
with legacy aliases
==================

{% with a as foo and b.c as bar %}X{% endwith %}

---

(template
  (content)
  (block
    (with_block
      (with_legacy_aliases
        (with_alias
          (filter_expression
            (primary_expression
              (lookup
                (identifier))))
          (identifier))
        (with_alias
          (filter_expression
            (primary_expression
              (lookup
                (identifier)
                (identifier))))
          (identifier)))
      (content)))
  (content))

==================
with underscore alias
==================

{% with foo as _bar %}X{% endwith %}

---

(template
  (content)
  (block
    (with_block
      (with_legacy_aliases
        (with_alias
          (filter_expression
            (primary_expression
              (lookup
                (identifier))))
          (identifier)))
      (content)))
  (content))

==================
with assignments
==================

{% with foo=1 bar=baz %}X{% endwith %}

---

(template
  (content)
  (block
    (with_block
      (with_assignments
        (assignment
          (identifier)
          (filter_expression
            (primary_expression
              (literal
                (number)))))
        (assignment
          (identifier)
          (filter_expression
            (primary_expression
              (lookup
                (identifier))))))
      (content)))
  (content))

==================
include valid only trailing
==================

{% include "tmpl.html" with foo="bar" only %}

---

(template
  (content)
  (block
    (include_tag
      (filter_expression
        (primary_expression
          (literal
            (string))))
      (assignment
        (identifier)
        (filter_expression
          (primary_expression
            (literal
              (string)))))))
  (content))

==================
include valid only-with order
==================

{% include "tmpl.html" only with foo="bar" %}

---

(template
  (content)
  (block
    (include_tag
      (filter_expression
        (primary_expression
          (literal
            (string))))
      (assignment
        (identifier)
        (filter_expression
          (primary_expression
            (literal
              (string)))))))
  (content))

==================
lorem forms
==================

{% lorem %}
{% lorem 3 p %}
{% lorem count random %}

---

(template
  (content)
  (block
    (lorem_tag))
  (content)
  (block
    (lorem_tag
      (filter_expression
        (primary_expression
          (literal
            (number))))))
  (content)
  (block
    (lorem_tag
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))))
  (content))

==================
verbatim suffix match
==================

{% verbatim custom name %}
{{ not parsed }}
{% endverbatim custom name %}

---

(template
  (content)
  (block
    (verbatim_block))
  (content))

==================
cycle as silent
==================

{% cycle 'row1' rowvalue2 'row3' as rowcolors silent %}

---

(template
  (content)
  (block
    (cycle_tag
      (cycle_value
        (string))
      (cycle_value
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))
      (cycle_value
        (string))
      (identifier)))
  (content))

==================
cycle i18n values
==================

{% cycle _("one") _("two") as choice %}

---

(template
  (content)
  (block
    (cycle_tag
      (cycle_value
        (i18n_string))
      (cycle_value
        (i18n_string))
      (identifier)))
  (content))

==================
load from library
==================

{% load foo bar from baz.qux %}

---

(template
  (content)
  (block
    (load_tag
      (library_item)
      (library_item)
      (library_item)))
  (content))

==================
url named args and as
==================

{% url "view-name" id=foo.slug page=2 as the_url %}

---

(template
  (content)
  (block
    (url_tag
      (filter_expression
        (primary_expression
          (literal
            (string))))
      (named_url_argument
        (identifier)
        (filter_expression
          (primary_expression
            (lookup
              (identifier)
              (identifier)))))
      (named_url_argument
        (identifier)
        (filter_expression
          (primary_expression
            (literal
              (number)))))
      (identifier)))
  (content))

==================
autoescape off block
==================

{% autoescape off %}
  {{ x }}
{% endautoescape %}

---

(template
  (content)
  (block
    (autoescape_block
      (content)
      (interpolation
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))
      (content)))
  (content))

==================
filter block chain
==================

{% filter upper|add:"!" %}
  hi
{% endfilter %}

---

(template
  (content)
  (block
    (filter_block
      (filter_chain
        (filter_call
          (filter_name
            (identifier)))
        (filter_call
          (filter_name
            (identifier))
          (filter_argument
            (literal
              (string)))))
      (content)))
  (content))

==================
spaceless block
==================

{% spaceless %}<p>
  <a> x </a>
</p>{% endspaceless %}

---

(template
  (content)
  (block
    (spaceless_block
      (content)))
  (content))

==================
if branching and operators
==================

{% if a %}yes{% elif c is not None %}maybe{% else %}no{% endif %}

---

(template
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))))))
      (content)
      (if_tail
        (elif_tag
          (test_expression
            (or_expression
              (and_expression
                (not_expression
                  (comparison_expression
                    (comparison_operand
                      (filter_expression
                        (primary_expression
                          (lookup
                            (identifier)))))
                    (comparison_operator)
                    (comparison_operand
                      (filter_expression
                        (primary_expression
                          (lookup
                            (identifier)))))))))))
        (content)
        (if_tail
          (else_tag)
          (content)
          (endif_tag)))))
  (content))

==================
ifchanged with args
==================

{% ifchanged a b %}yes{% else %}no{% endifchanged %}

---

(template
  (content)
  (block
    (ifchanged_block
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (content)
      (content)))
  (content))

==================
if with and/or
==================

{% if a and b or c %}yes{% else %}no{% endif %}

---

(template
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier))))))))
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))))))
      (content)
      (if_tail
        (else_tag)
        (content)
        (endif_tag))))
  (content))

==================
if unary not
==================

{% if not user.is_active %}inactive{% endif %}

---

(template
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (not_expression
                  (comparison_expression
                    (comparison_operand
                      (filter_expression
                        (primary_expression
                          (lookup
                            (identifier)
                            (identifier))))))))))))
      (content)
      (if_tail
        (endif_tag))))
  (content))

==================
if comparison operators
==================

{% if a == b != c < d <= e > f >= g %}cmp{% endif %}
{% if item in items %}in{% endif %}
{% if item not in items %}notin{% endif %}

---

(template
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))))))
      (content)
      (if_tail
        (endif_tag))))
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))))))
      (content)
      (if_tail
        (endif_tag))))
  (content)
  (block
    (if_block
      (if_open
        (test_expression
          (or_expression
            (and_expression
              (not_expression
                (comparison_expression
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))
                  (comparison_operator)
                  (comparison_operand
                    (filter_expression
                      (primary_expression
                        (lookup
                          (identifier)))))))))))
      (content)
      (if_tail
        (endif_tag))))
  (content))

==================
for reversed unpack with empty
==================

{% for x, y in items reversed %}{{ x }}{{ y }}{% empty %}none{% endfor %}

---

(template
  (content)
  (block
    (for_block
      (loop_targets
        (loop_target)
        (loop_target))
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (interpolation
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))
      (interpolation
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))
      (content)))
  (content))

==================
regroup then unpack
==================

{% regroup data by bar as grouped %}{% for grouper, group in grouped %}{{ grouper }}{% endfor %}

---

(template
  (content)
  (block
    (regroup_tag
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (identifier)
      (identifier)))
  (block
    (for_block
      (loop_targets
        (loop_target)
        (loop_target))
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (interpolation
        (filter_expression
          (primary_expression
            (lookup
              (identifier)))))))
  (content))

==================
resetcycle undefined
==================

{% resetcycle undefinedcycle %}

---

(template
  (content)
  (block
    (resetcycle_tag
      (identifier)))
  (content))

==================
cycle nested ifchanged
==================

{% cycle 'a' 'b' 'c' as cycler silent %}{% for x in values %}{% ifchanged x %}{% cycle cycler %}{{ cycler }}{% else %}{{ cycler }}{% endifchanged %}{% endfor %}

---

(template
  (content)
  (block
    (cycle_tag
      (cycle_value
        (string))
      (cycle_value
        (string))
      (cycle_value
        (string))
      (identifier)))
  (block
    (for_block
      (loop_targets
        (loop_target))
      (filter_expression
        (primary_expression
          (lookup
            (identifier))))
      (block
        (ifchanged_block
          (filter_expression
            (primary_expression
              (lookup
                (identifier))))
          (block
            (cycle_tag
              (cycle_value
                (filter_expression
                  (primary_expression
                    (lookup
                      (identifier)))))))
          (interpolation
            (filter_expression
              (primary_expression
                (lookup
                  (identifier)))))
          (interpolation
            (filter_expression
              (primary_expression
                (lookup
                  (identifier)))))))))
  (content))

==================
load unknown tag
==================

{% load debugtags %}{% go_boom %}

---

(template
  (content)
  (block
    (load_tag
      (library_item)))
  (block
    (generic_tag
      (tag_name)))
  (content))

==================
unterminated blocktranslate
==================

{% load i18n %}{% blocktranslate %}This should fail{% blocktranslate %}

---

(template
  (content)
  (block
    (load_tag
      (library_item)))
  (block
    (generic_tag
      (ERROR)
      (tag_name)))
  (ERROR
    (content)
    (ERROR)
    (tag_name)
    (content)))
